<style>
@import url("https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@400;500;600;700;800;900&display=swap");

.ebook-grid {
  --gap: 16px;
  display: grid;
  gap: var(--gap);
  align-items: stretch;
}

.ebook-item.card {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1; /* carré responsive */
  display: flex;
  justify-content: center;
  align-items: center;
  transition: transform .4s ease;
  border-radius: 20px;
  overflow: hidden;
  font-family: "Barlow Semi Condensed", sans-serif;
}

.card .circle {
  position: absolute;
  inset: 0;
  border-radius: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.card .circle::before {
  content: "";
  position: absolute;
  inset: 10%;
  border-radius: 50%;
  background: #191919;
  border: 8px solid var(--clr);
  filter: drop-shadow(0 0 10px var(--clr)) drop-shadow(0 0 60px var(--clr));
  transition: .5s, background .5s;
  transition-delay: .4s, .7s;
}

.card:hover .circle::before {
  inset: 0;
  border-radius: 20px;
  background: var(--clr);
  transition-delay: .2s;
}

.card .logo {
  position: relative;
  width: 55%;
  max-width: 260px;
  transition: .5s;
  transition-delay: .3s;
  z-index: 1;
}

.card:hover .logo {
  transform: scale(0);
  transition-delay: 0s;
}

.card .product_img {
  position: absolute;
  top: 50%;
  left: 50%;
  height: 55%;
  max-height: 340px;
  transform: translate(-50%, -50%) scale(0) rotate(315deg);
  transition: .6s ease-in-out;
  z-index: 2;
}

.card:hover .product_img {
  transition-delay: .5s;
  top: 58%;
  left: 82%;
  transform: translate(-50%, -50%) scale(1) rotate(15deg);
}

.card .content {
  position: absolute;
  width: 60%;
  left: 8%;
  padding: 16px;
  opacity: 0;
  visibility: hidden;
  transition: .5s;
  z-index: 3;
}

.card:hover .content {
  transition-delay: .5s;
  opacity: 1;
  visibility: visible;
  left: 4%;
  margin-top: 8px;
}

.card .content h2 {
  color: #fff;
  text-transform: uppercase;
  font-size: clamp(18px, 2.4vw, 28px);
  line-height: 1.2;
  margin: 0 0 8px 0;
}

.card .content p {
  color: #fff;
  font-size: clamp(12px, 1.6vw, 14px);
  margin: 0;
}

.card .content a.btn {
  position: relative;
  color: #fff;
  background: #222;
  padding: 10px 16px;
  border-radius: 10px;
  display: inline-block;
  text-decoration: none;
  font-weight: 600;
  margin-top: 14px;
}

/* Grille responsive avec colonnes contrôlées par settings */
@media (max-width: 767px) {
  .ebook-grid { grid-template-columns: repeat(var(--cols-mobile), minmax(0, 1fr)); }
  .ebook-grid > .ebook-item:nth-child(n + {{ section.settings.limit_mobile | plus: 1 }}) { display: none; }
}
@media (min-width: 768px) and (max-width: 1023px) {
  .ebook-grid { grid-template-columns: repeat(var(--cols-tablet), minmax(0, 1fr)); }
  .ebook-grid > .ebook-item:nth-child(n + {{ section.settings.limit_tablet | plus: 1 }}) { display: none; }
}
@media (min-width: 1024px) {
  .ebook-grid { grid-template-columns: repeat(var(--cols-desktop), minmax(0, 1fr)); }
  .ebook-grid > .ebook-item:nth-child(n + {{ section.settings.limit_desktop | plus: 1 }}) { display: none; }
}
</style>

<div
  class="ebook-grid"
  style="
    --cols-mobile: {{ section.settings.columns_mobile | default: 1 }};
    --cols-tablet: {{ section.settings.columns_tablet | default: 3 }};
    --cols-desktop: {{ section.settings.columns_desktop | default: 4 }};
  "
>
  {% for block in section.blocks %}
    {% assign product = block.settings.product %}
    {% assign cover = block.settings.cover_image %}
    {% if cover == blank and product %}
      {% assign cover = product.featured_image %}
    {% endif %}

    <article class="card ebook-item" style="--clr: {{ block.settings.accent_color | default: '#fd7015' }};" {{ block.shopify_attributes }}>
      <div class="circle">
        {% if cover %}
          <img
            class="logo"
            src="{{ cover | image_url: width: 520 }}"
            alt="{{ product.title | default: 'Ebook' | escape }}"
            loading="lazy"
          >
        {% endif %}
      </div>

      <div class="content">
        <h2>{{ block.settings.title | default: product.title | default: 'Titre du livre' }}</h2>
        {% if product and product.description != blank %}
          <p>{{ product.description | strip_html | truncate: 120 }}</p>
        {% endif %}
        {% assign btn_url = block.settings.button_url %}
        {% if btn_url == blank and product %}
          {% assign btn_url = product.url %}
        {% endif %}
        <a class="btn" href="{{ btn_url | default: '#' }}">
          {{ block.settings.button_text | default: 'Voir le livre' }}
        </a>
      </div>

      {% liquid
        assign pages = block.settings.pages_image
        if pages == blank and product and product.media and product.media.size > 1
          assign second = product.media[1]
        endif
      %}
      {% if pages %}
        <img
          class="product_img"
          src="{{ pages | image_url: width: 820 }}"
          alt="{{ product.title | default: 'Ebook' | escape }} - pages"
          loading="lazy"
        >
      {% elsif second and second.preview_image %}
        <img
          class="product_img"
          src="{{ second.preview_image | image_url: width: 820 }}"
          alt="{{ product.title | default: 'Ebook' | escape }} - pages"
          loading="lazy"
        >
      {% endif %}
    </article>
  {% endfor %}

  {% if section.blocks.size == 0 %}
    <article class="card ebook-item" style="--clr:#fd7015;">
      <div class="circle">
        <img class="logo" src="https://cdn.shopify.com/s/files/1/0533/2089/files/placeholder-images-image_large.png" alt="Placeholder" loading="lazy">
      </div>
      <div class="content">
        <h2>Connaissance Illimitée</h2>
        <p>Ajoutez des blocs “Ebook” dans la section pour afficher vos produits.</p>
        <a class="btn" href="#">JE VEUX MON EXEMPLAIRE</a>
      </div>
      <img class="product_img" src="https://cdn.shopify.com/s/files/1/0533/2089/files/placeholder-images-lifestyle-2_large.png" alt="Pages du livre" loading="lazy">
    </article>
  {% endif %}
</div>

{% schema %}
{
  "name": "Ebook - Grille produits",
  "settings": [
    { "type": "range", "id": "columns_mobile", "label": "Colonnes (mobile)", "min": 1, "max": 3, "step": 1, "default": 1 },
    { "type": "range", "id": "columns_tablet", "label": "Colonnes (tablette)", "min": 2, "max": 4, "step": 1, "default": 3 },
    { "type": "range", "id": "columns_desktop", "label": "Colonnes (ordinateur)", "min": 3, "max": 6, "step": 1, "default": 4 },

    { "type": "range", "id": "limit_mobile", "label": "Produits affichés (mobile)", "min": 1, "max": 12, "step": 1, "default": 3 },
    { "type": "range", "id": "limit_tablet", "label": "Produits affichés (tablette)", "min": 1, "max": 24, "step": 1, "default": 6 },
    { "type": "range", "id": "limit_desktop", "label": "Produits affichés (ordinateur)", "min": 1, "max": 50, "step": 1, "default": 9 }
  ],
  "blocks": [
    {
      "type": "ebook",
      "name": "Ebook",
      "settings": [
        { "type": "product", "id": "product", "label": "Produit" },
        { "type": "image_picker", "id": "cover_image", "label": "Photo de fiche (override)" },
        { "type": "image_picker", "id": "pages_image", "label": "Photo des pages du livre" },
        { "type": "text", "id": "title", "label": "Titre personnalisé" },
        { "type": "text", "id": "button_text", "label": "Texte du bouton", "default": "Voir le livre" },
        { "type": "url", "id": "button_url", "label": "Lien du bouton" },
        { "type": "color", "id": "accent_color", "label": "Couleur d'accent", "default": "#fd7015" }
      ]
    }
  ],
  "max_blocks": 50,
  "presets": [
    { "name": "Ebook - Grille produits", "category": "Produits" }
  ]
}
{% endschema %}